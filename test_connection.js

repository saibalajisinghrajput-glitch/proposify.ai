const axios = require('axios');

async function testCompleteConnection() {
  console.log('üîß Testing Backend-Frontend Connection...\n');

  // Test 1: Backend Health Check
  try {
    const healthResponse = await axios.get('http://localhost:5001/api/health');
    console.log('‚úÖ Backend Health Check: PASSED');
    console.log(`   Status: ${healthResponse.data.status}`);
    console.log(`   Database: ${healthResponse.data.database}`);
    console.log(`   JWT Secret: ${healthResponse.data.jwtSecret}\n`);
  } catch (error) {
    console.log('‚ùå Backend Health Check: FAILED');
    console.log(`   Error: ${error.message}\n`);
  }

  // Test 2: Signup Endpoint
  try {
    const signupResponse = await axios.post('http://localhost:5001/api/auth/signup', {
      name: 'Connection Test User',
      email: `test_${Date.now()}@example.com`,
      password: 'testpassword123'
    });
    
    console.log('‚úÖ Signup Test: PASSED');
    console.log(`   Status: ${signupResponse.status}`);
    console.log(`   User Created: ${signupResponse.data.user.name}`);
    console.log(`   Token Generated: ${signupResponse.data.token.substring(0, 50)}...`);
    console.log(`   Subscription: ${signupResponse.data.user.subscription}\n`);
  } catch (error) {
    console.log('‚ùå Signup Test: FAILED');
    if (error.response) {
      console.log(`   Status: ${error.response.status}`);
      console.log(`   Message: ${error.response.data.message}`);
    } else {
      console.log(`   Error: ${error.message}`);
    }
    console.log('');
  }

  // Test 3: Login Endpoint
  try {
    const loginResponse = await axios.post('http://localhost:5001/api/auth/login', {
      email: 'test_success@example.com', // From previous successful test
      password: 'password123'
    });
    
    console.log('‚úÖ Login Test: PASSED');
    console.log(`   Status: ${loginResponse.status}`);
    console.log(`   User: ${loginResponse.data.user.name}`);
    console.log(`   Token: ${loginResponse.data.token.substring(0, 50)}...\n`);
  } catch (error) {
    console.log('‚ùå Login Test: FAILED');
    if (error.response) {
      console.log(`   Status: ${error.response.status}`);
      console.log(`   Message: ${error.response.data.message}`);
    } else {
      console.log(`   Error: ${error.message}`);
    }
    console.log('');
  }

  // Test 4: CORS Configuration
  try {
    const corsResponse = await axios.options('http://localhost:5001/api/auth/signup');
    console.log('‚úÖ CORS Test: PASSED');
    console.log(`   Status: ${corsResponse.status}`);
    console.log(`   Access-Control-Allow-Origin: ${corsResponse.headers['access-control-allow-origin']}\n`);
  } catch (error) {
    console.log('‚ùå CORS Test: FAILED');
    console.log(`   Error: ${error.message}\n`);
  }

  console.log('üéØ CONNECTION STATUS:');
  console.log('Backend: Running on http://localhost:5001');
  console.log('Frontend: Check http://localhost:3000 (React app)');
  console.log('Database: MongoDB connection required for full functionality');
  console.log('\nüìã NEXT STEPS:');
  console.log('1. Start MongoDB: brew services start mongodb-community');
  console.log('2. Open http://localhost:3000 in browser');
  console.log('3. Test signup form with valid email/password');
}

testCompleteConnection();


